<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
/*
List of known unsupported features:
Tile id retention.
Tile name retention.
Tile locked retention.
Tile alpha (if this even applies, not sure if it's unused in 1.4).
Any and all view/background properties (These will retain the original level's).

*/
/* List of currently unsupported features that need to be setup.
-Object editing window (Containing ability to change scale, code, blend, etc.)
-Code editing interface (Have it launch GMLCE and just wait out frames until it's closed).
-

*/
depth = -1000;

global.newLine = "
";
event_inherited();

var fileHandler = file_text_open_read(get_open_filename("GMS1.4 Room Files|*.room.gmx",""));//working_directory + "lvlCopyThisRoom.room.gmx");
//file_text_read_string("lvlCopyThisRoom.room.gmx");

maxLineCount = 0;
lineCount = 0;
while (!file_text_eof(fileHandler))
{
    /*if (iteration &gt;= processRate &amp;&amp; processRate &gt;= 0)
    {
        // To prevent lag, stop loading after a set number of frames.
        completion = 0.25 * min(1, lineCount / maxLineCount);
        exit;
    }*/
    //iteration += iterationRate;
    var lineS = file_text_readln(fileHandler);
    maxLineCount++;
    lines[lineCount++] = lineS;

    // hash repeatedly to avoid large string handling.
    //hashString = md5_string_utf8(hashString + global.newLine + lineS);
}

file_text_close(fileHandler);
//processedFile = true;
//processedLines = false;
//startParseCompletion = 0.25 * min(1, lineCount / maxLineCount);

//Defining this all here in the unlikely event one of these is empty.
code_str = "";//The room CC.
prop_background = -1;//Background (non-tiled)
prop_inst = -1;//Instances.
prop_tile = -1;//Tiles.

project_objects = ds_map_create();
project_sprites = ds_map_create();
project_backgrounds = ds_map_create();
project_backgrounds_reverseLookup = ds_map_create();//Used specifically to reverse-lookup on export.
project_backgrounds_tileData = ds_map_create();

prop_bg_n = 0;
prop_inst_n = 0;
prop_tile_n = 0;

event_user(0);//editor_ParseRoomData();


for (var i = 0; i &lt; array_length_1d(prop_inst); i++)
{
    var instance = prop_inst[i]
    
    with (instance_create(real(instance[? "x"]),real(instance[? "y"]),objEditorObject))
    {
        objName = instance[? "objName"];
        instanceName = instance[? "name"];
        locked = real(instance[? "locked"]);
        code = instance[? "code"];
        image_xscale = real(instance[? "scaleX"]);
        image_yscale = real(instance[? "scaleY"]);
        image_blend = real(instance[? "colour"])-4278190080;//Minus the alpha value. Note: Even though GMS stores it with an alpha value, you can never define alpha colors in GMS's Room editor.
//        image_alpha = real(instance[? "colour"])-image_blend;//The newly seperated color value.
        image_angle = real(instance[? "rotation"]);
        with (other)
        {
            parseAsset("object",other.objName);
        }
        var objData = other.project_objects[? objName];
        depth = objData[1];
        var spr = other.project_sprites[? objData[0]];
        if (spr != "")
        {
            sprite_index = spr;
        }
        else
        {
            sprite_index = sprButton;
        }
    }
}
for (var i = 0; i &lt; array_length_1d(prop_tile); i++)
{
    var tile = prop_tile[i]
    parseAsset("tile",tile[? "bgName"]);
    var tileID = tile_add(project_backgrounds[? tile[? "bgName"]], real(tile[? "xo"]), real(tile[? "yo"]), real(tile[? "w"]), real(tile[? "h"]), real(tile[? "x"]), real(tile[? "y"]), real(tile[? "depth"]));
    tile_set_blend(tileID, real(tile[? "colour"])-4278190080);
    tile_set_scale(tileID, real(tile[? "scaleX"]), real(tile[? "scaleY"]));
    
    
}
//show_debug_message(c_white);


mouse_x_previous = mouse_x;
mouse_y_previous = mouse_y;
mouse_motionX = 0;
mouse_motionY = 0;
zoomLevel = 1;



selectedObject = noone;
selectedObject_XOffset = 0;
selectedObject_YOffset = 0;
holdingObject = false;

gridsnap_X = 16;
gridsnap_Y = 16;
eventName = "";

cancelRoomTouch = false;


var menus = makeArray(editorCreateMenu("objects","right",(view_hview/2),300,300+64));



event_user(1);

display_set_gui_maximise();

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="1" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Make sure to destroy lists/maps created here later.

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
cancelRoomTouch = false;
with (objEditorMenu)
{
    event_user(1);
}
if (cancelRoomTouch)
{
    exit;
}
if (mouse_wheel_up() || mouse_wheel_down())
{
    var pX = (mouse_x-view_xview)/view_wview;//Fractional point of where the mouse is atm.
    var pY = (mouse_y-view_yview)/view_hview;
    //show_debug_message(pX);
    //show_debug_message(pY);
    var mousePower = .125;
    if (mouse_wheel_up())
    {
        mousePower *= -1;
    }
    if (zoomLevel+mousePower &gt; 0)
    {
        zoomLevel += mousePower;
        view_wview = view_wport*zoomLevel;
        view_hview = view_hport*zoomLevel;
        
        view_xview = (mouse_x-view_wview*pX);
        view_yview = (mouse_y-view_hview*pY);
        
        //view_xview += window_view_mouse_get_x(0)-pX;
        //view_yview += window_view_mouse_get_y(0)-pY;
        //show_debug_message(window_view_mouse_get_x(0)-pX);
        //view_xview = lerp(pX,(mouse_x-view_wview/2),.1*max(1,mousePower));
        //view_yview = lerp(pY,(mouse_y-view_hview/2),.1*max(1,mousePower));
    
    }
}
if (mouse_check_button(mb_middle))
{
    mouse_motionX = mouse_x-mouse_x_previous;
    mouse_motionY = mouse_y-mouse_y_previous;
    
    view_xview -= mouse_motionX;
    view_yview -= mouse_motionY;
}

mouse_x_previous = mouse_x-mouse_motionX;
mouse_y_previous = mouse_y-mouse_motionY;


if (mouse_check_button_pressed(mb_left))
{
    //if (selectedObject == noone)
    //{
    selectedObject = collision_point(mouse_x,mouse_y,objEditorObject,false,false)
    //}
    if (selectedObject == noone)
    {
        show_debug_message("Todo: Create");
    }
    else
    {
        selectedObject_XOffset = selectedObject.x-mouse_x;
        selectedObject_YOffset = selectedObject.y-mouse_y;
        holdingObject = true;
    }
}
else if (mouse_check_button_released(mb_left))
{
    holdingObject = false;//selectedObject = noone;
}
if (mouse_check_button(mb_left))
{
    if (instance_exists(selectedObject) &amp;&amp; holdingObject)
    {
        selectedObject.x = mouse_x+selectedObject_XOffset;
        selectedObject.y = mouse_y+selectedObject_YOffset;
        with (selectedObject)
        {
            move_snap(16,16);
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="12">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///reserved for button usage.
//show_debug_message(eventName);
if (mouse_check_button_pressed(mb_left))
{
    switch (eventName)
    {
    
        default:
            show_debug_message(eventName);
        break;
        case "objects-X":
        case "objects-Y":
        case "objects-XScale":
        case "objects-YScale":
        case "objects-XFlip":
        case "objects-YFlip":
        case "objects-Angle":
        case "objects-Alpha":
        case "objects-OBJImage":
        case "objects-Color":
            with (selectedObject)
            {
                switch (other.eventName)
                {
                    case "objects-X":
                        x = real(get_string("Set X value",string(x)));
                    break;
                    case "objects-Y":
                        y = real(get_string("Set Y value",string(y)));
                    break;
                    case "objects-XScale":
                        image_xscale = real(get_string("Set XScale value",string(image_xscale)));
                    break;
                    case "objects-YScale":
                        image_yscale = real(get_string("Set YScale value",string(image_yscale)));
                    break;
                    case "objects-XFlip":
                        image_xscale *= -1;
                    break;
                    case "objects-YFlip":
                        image_yscale *= -1;
                    break;
                    case "objects-Angle":
                        image_angle = real(get_string("Set Image Angle value",string(image_angle)));
                    break;
                    case "objects-Alpha":
                        image_alpha = real(get_string("Set Image Alpha value",string(image_alpha)));
                    break;
                    case "objects-OBJImage":break;
                    case "objects-Color":
                        image_angle = real(get_string("Set Image Color value (integer form)",string(image_blend)));
                    break;
                }
            }
        
        break;
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="11">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Export
//for (var i = 0; i &lt; array_length_1d(prop_tile))

var objectString = "";
//for (var i = 0; i &lt; array_length_1d(prop_inst); i++)
//{
//    var inst = prop_inst[i];
var i = 0;
with (objEditorObject)
{
    var stringOut = '&lt;instance objName="' + objName + '" x="' + string(x) + '" y="' + string(y) + 
    '" name="' + instanceName + '" locked="' + string(locked) + '" code="' + code + 
    '" scaleX="' + string(image_xscale) + '"scaleY="' + string(image_yscale) + 
    'colour="' + string(image_blend+4278190080) + '" rotation="' + string(image_angle) + '"/&gt;';
    objectString += stringOut + global.newLine;
    
}   

var tileString = "";

var allTiles = tile_get_ids();

for (var i = 0; i &lt; array_length_1d(allTiles); i++)
{
    var thisTile = allTiles[i];
    var tileOut = '&lt;tile bgName="' + project_backgrounds_reverseLookup[? string(tile_get_background(thisTile))] 
    + '" x="' + string(tile_get_x(thisTile)) + '" y="' + string(tile_get_y(thisTile)) 
    + '" w="' + string(tile_get_width(thisTile)) + '" h="' + string(tile_get_height(thisTile)) 
    + '" xo="' + string(tile_get_left(thisTile)) + '" yo="' + string(tile_get_top(thisTile)) 
    + '" id="inst_' + string(dec_to_hex(i,8)) + '" depth="' + string(tile_get_depth(thisTile)) 
    + '" locked="0" colour = "' + string(tile_get_blend(thisTile) + 4278190080) 
    + '" scaleX="' + string(tile_get_xscale(thisTile)) + '" scaleY="' + string(tile_get_yscale(thisTile)) 
    + '"/&gt;';
    tileString += tileOut + global.newLine;
    i++;
}
show_debug_message(objectString);
show_debug_message(tileString);


//}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
/// editor_ParseRoomData
var line = 0;
while (line &lt; maxLineCount)
{
    var text = lines[line++];
    
    text = stringSubstring(text, string_pos("&lt;", text));
    
    // room properties
    if (stringStartsWith(text, "&lt;width&gt;"))
        room_set_width(lvlEditor,real(string_digits(text)));
    if (stringStartsWith(text, "&lt;height&gt;"))
        room_set_height(lvlEditor,real(string_digits(text)));
    if (stringStartsWith(text, "&lt;colour&gt;"))
        background_color = real(string_digits(text));
    if (stringStartsWith(text, "&lt;code&gt;"))
    {
        code_str = text + global.newLine;
        while (line &lt; lineCount)
        {
            //iteration+= iterationRate;
            if (string_pos("&lt;/code&gt;", code_str) != 0)
                break;
            code_str += lines[line++] + global.newLine;
        }
        continue;
    }
    
    // backgrounds
    if (stringStartsWith(text, "&lt;background "))
    {
        prop_background[prop_bg_n++] = xmlParseTag(text);
    }
    
    // views [not implemented]
    
    // instances
    if (stringStartsWith(text, "&lt;instance "))
    {
        prop_inst[prop_inst_n++] = xmlParseTag(text);
    }
    
    // tiles
    if (stringStartsWith(text, "&lt;tile "))
    {
        prop_tile[prop_tile_n++] = xmlParseTag(text);
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="73">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>with (selectedObject)
{
    /*draw_set_color(c_white-background_color);//c_ltgray);
    draw_rectangle(bbox_left-1,bbox_top-1,bbox_right+1,bbox_bottom+1,false);
    draw_set_color(c_white);
    other.depth = depth+1;*/
    //var oB = image_blend;
    //image_blend = c_yellow;
    image_alpha = .5;
    d3d_set_fog(true,c_yellow,0,0);
    draw_self();//draw_sprite(sprite_index,image_index,x,y);
    d3d_set_fog(false,c_white,0,0);
    image_alpha = 1;
    //image_blend = oB;
}
//depth = 0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
